<div class="table-wrapper">
  <table class="table table-striped mb-0">
    <thead>
      <tr>
        <th><span class="visually-hidden">Risultato</span></th>
        <th>Tipologia</th>
        <th>Url sito</th>
        <th>Durata</th>
        <th class="text-nowrap">% Successo</th>
          <th>Criteri selezionati</th>
        <th>Data</th>
        <th><span class="visually-hidden">Azioni</span></th>
      </tr>
    </thead>
    <tbody>
      <% items.forEach(item => { %>
        <tr>
          <td>
            <% if (item.status === 'pending' || item.status === 'cancelled') { %>
              <div class="legend-item">
                <div aria-labelledby="legend-undone" class="circle undone" aria-hidden="true">&times;</div>
              </div>
            <% } else { %>
                <div class="legend-item">
                  <div aria-labelledby="legend-<%- item.errorCount > 0 ? 'error' : item.failedCount > 0 ? 'fail' : 'pass' %>" class="circle <%- item.errorCount > 0 ? 'error' : item.failedCount > 0 ? 'fail' : 'pass' %>">
                    <%- item.errorCount > 0 ? '&times;' : '' %>
                  </div>
                </div>
            <% } %>
          </td>
          <td><%- item.type %></td>
          <td>
            <a href="<%- item.url %>"><%- item.url %></a>
            <span class="visually-hidden"> - apre in una nuova scheda</span>
          </td>
          <td>
            <% if (item.executionTime) { %>
              <%- new Date(item.executionTime).toISOString().slice(11,19) %>
            <% } else { %>
              <span aria-hidden="true">-</span><span class="visually-hidden">Non definito</span>
            <% } %>
          </td>
          <td>
            <% if (item.status === 'pending' || item.status === 'cancelled') { %>
              Interrotta
            <% } else { %>
              <%= isNaN(Math.round((item.successCount / (item.successCount + item.failedCount + item.errorCount)) * 100)) ? 0 : Math.round((item.successCount / (item.successCount + item.failedCount + item.errorCount)) * 100) %>%
            <% } %>
          </td>

            <td>
                <%= item.successCount + item.failedCount + item.errorCount %>
            </td>
          <td>
            <%- new Intl.DateTimeFormat('it-IT', { dateStyle: "short", timeStyle: "short" }).format(new Date(item.date)) %>
          </td>
          <td>
            <div class="d-flex align-items-end gap-2">
              <a class="icon-link" data-page="report" href="<%= "/report?id="+item.id %>" title="Pagina di dettaglio">
                <svg class="icon">
                  <use href="#it-note"></use>
                </svg>
                <span class="visually-hidden">Pagina di dettaglio</span>
              </a>
              <button class="icon-link" data-open-report="<%=item.id %>" title="Apri dettaglio in una nuova scheda" <%= (item.status === 'pending' || item.status === 'cancelled') ? "disabled" : "" %>>
                <svg class="icon">
                  <use href="#it-password-visible"></use>
                </svg>
                <span class="visually-hidden">Apri dettaglio in una nuova scheda</span>
              </button>
              <button class="icon-link" data-download="<%=item.id %>" title="Scarica report" <%= (item.status === 'pending' || item.status === 'cancelled') ? "disabled" : "" %>>
                <svg class="icon">
                  <use href="#it-download"></use>
                </svg>
                <span class="visually-hidden">Scarica report</span>
              </button>
              <button class="icon-link" data-delete="<%=item.id %>" title="Elimina report" data-bs-toggle="modal" data-bs-target="#modal-confirm-delete" aria-haspopup="dialog">
                <svg class="icon">
                  <use href="#it-delete"></use>
                </svg>
                <span class="visually-hidden">Elimina report</span>
              </button>
            </div>
          </td>
        </tr>
      <% }); %>
    </tbody>
  </table>

  <% if (items.length === 0) { %>
    <%- include('components/no-results'); %>
  <% } %>
</div>